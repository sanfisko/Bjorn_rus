# WiFi Автоподключение

## Описание

WiFi автоподключение - это сервис, который автоматически подключается к доступным WiFi сетям на основе сохраненных учетных данных или открытых сетей.

## Возможности

- **Автоматическое подключение к известным сетям**: Подключается к сетям, учетные данные которых сохранены в системе
- **Подключение к открытым сетям**: Автоматически подключается к открытым WiFi сетям
- **Загрузка учетных данных с USB**: Поддерживает загрузку учетных данных WiFi с USB-накопителя
- **Веб-интерфейс управления**: Полное управление через веб-интерфейс Bjorn
- **Логирование**: Подробное логирование всех операций

## Формат файла учетных данных

Создайте .txt файл на USB-накопителе с учетными данными WiFi в формате:
```
SSID1:Password1
SSID2:Password2
MyNetwork:MyPassword123
```

Каждая строка должна содержать SSID и пароль, разделенные двоеточием.

## Управление через веб-интерфейс

### Основные настройки
1. Откройте страницу конфигурации Bjorn
2. Найдите секцию "WiFi Автоподключение"
3. Используйте переключатель для включения/отключения автозапуска сервиса

### Ручное управление
- **Запустить**: Запускает сервис автоподключения
- **Остановить**: Останавливает сервис автоподключения  
- **Включить автозапуск**: Включает автоматический запуск сервиса при загрузке системы
- **Отключить автозапуск**: Отключает автоматический запуск сервиса

### Статус сервиса
Веб-интерфейс показывает текущий статус:
- **Статус**: Запущен/Остановлен
- **Автозапуск**: Включен/Отключен

## Управление через командную строку

### Systemctl команды
```bash
# Запуск сервиса
sudo systemctl start wifi-auto-connect.service

# Остановка сервиса
sudo systemctl stop wifi-auto-connect.service

# Включение автозапуска
sudo systemctl enable wifi-auto-connect.service

# Отключение автозапуска
sudo systemctl disable wifi-auto-connect.service

# Проверка статуса
sudo systemctl status wifi-auto-connect.service

# Просмотр логов
sudo journalctl -u wifi-auto-connect.service -f
```

### Ручной запуск скрипта
```bash
# Запуск скрипта напрямую (для отладки)
sudo /home/bjorn/Bjorn_rus/wifi_auto_connect.sh
```

## Логирование

Сервис ведет подробные логи:
- **Системные логи**: `journalctl -u wifi-auto-connect.service`
- **Syslog**: Сообщения также отправляются в syslog с тегом `wifi_usb_connect`

## Алгоритм работы

1. **Проверка USB**: Поиск USB-накопителей с .txt файлами
2. **Извлечение учетных данных**: Чтение и сохранение учетных данных WiFi
3. **Сканирование сетей**: Поиск доступных WiFi сетей
4. **Приоритет подключения**:
   - Сначала известные сети (по силе сигнала)
   - Затем открытые сети (по силе сигнала)
5. **Повтор**: Цикл повторяется каждые 30 секунд

## Безопасность

- Файл учетных данных (`~/wifi_net.txt`) создается с правами 600 (только владелец)
- Пароли не отображаются в логах
- USB автоматически размонтируется после извлечения учетных данных

## Устранение неполадок

### Сервис не запускается
```bash
# Проверьте статус
sudo systemctl status wifi-auto-connect.service

# Проверьте логи
sudo journalctl -u wifi-auto-connect.service --no-pager
```

### USB не обнаруживается
- Убедитесь, что USB-накопитель содержит .txt файлы
- Проверьте права доступа к USB-накопителю
- Проверьте логи для сообщений об ошибках монтирования

### Не подключается к сетям
- Проверьте правильность формата файла учетных данных
- Убедитесь, что NetworkManager запущен
- Проверьте доступность сетей: `nmcli dev wifi list`

## Файлы конфигурации

- **Скрипт**: `/home/bjorn/Bjorn_rus/wifi_auto_connect.sh`
- **Сервис**: `/etc/systemd/system/wifi-auto-connect.service`
- **Учетные данные**: `~/wifi_net.txt`
- **Конфигурация**: `/home/bjorn/Bjorn_rus/config/shared_config.json`